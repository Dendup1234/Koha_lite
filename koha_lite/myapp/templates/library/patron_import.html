{% extends "base.html" %}
{% block title %}Import Patrons{% endblock %}
{% block content %}
<h2>Bulk Import â€” Patrons (CSV)</h2>
<p class="text-muted">
  Required headers: <code>external_id,first_name,last_name,email,category_code,expires_at(YYYY-MM-DD),is_active(true/false)</code>
</p>

<p class="mb-2">
  <a class="btn btn-sm btn-outline-dark" href="{% url 'patron_csv_template' %}">Download CSV Template</a>
  <a class="btn btn-sm btn-outline-secondary" href="{% url 'patron_list' %}">Back to list</a>
</p>

<form method="post" enctype="multipart/form-data" class="card card-body mb-3" style="max-width:640px">
  {% csrf_token %}
  <div class="mb-3">
    <label class="form-label">CSV File</label>
    {{ form.file }}
    <div class="form-text">{{ form.file.help_text }}</div>
  </div>
  <div class="form-check mb-3">
    {{ form.update_existing }} <label class="form-check-label">Update existing patrons (match by external_id)</label>
  </div>
  <button class="btn btn-primary" type="submit">Upload & Import</button>
</form>

{% if results %}
  <h5>Results</h5>
  <ul>
    <li>Created: <strong>{{ results.created }}</strong></li>
    <li>Updated: <strong>{{ results.updated }}</strong></li>
    <li>Skipped: <strong>{{ results.skipped }}</strong></li>
  </ul>
  {% if results.errors %}
    <div class="alert alert-warning">
      <strong>Issues:</strong>
      <ul>
        {% for e in results.errors %}
          <li>{{ e }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endif %}
{% endblock %}
