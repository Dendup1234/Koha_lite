{% extends "base.html" %}
{% block title %}Fines{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Fines</h2>
</div>

<form method="get" class="row g-2 mb-3">
  <div class="col-sm-5">
    <input class="form-control" name="q" value="{{ request.GET.q }}" placeholder="Search patron ID, accession, or title">
  </div>
  <div class="col-sm-3">
    <select name="status" class="form-select">
      <option value="all" {% if request.GET.status == 'all' or not request.GET.status %}selected{% endif %}>All</option>
      <option value="unpaid" {% if request.GET.status == 'unpaid' %}selected{% endif %}>Unpaid</option>
      <option value="paid" {% if request.GET.status == 'paid' %}selected{% endif %}>Paid</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-primary">Search</button>
  </div>
</form>

<div class="table-responsive">
<table class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>ID</th><th>Patron</th><th>Item</th><th>Title</th>
      <th>Type</th><th>Amount</th><th>Paid</th><th>Status</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for f in rows %}
    <tr>
      <td>{{ f.id }}</td>
      <td>{{ f.patron.external_id }}</td>
      <td>{{ f.item.accession_number }}</td>
      <td>{{ f.item.biblio.title }}</td>
      <td>{{ f.fine_type }}</td>
      <td>{{ f.amount }}</td>
      <td>{{ f.paid_amount }}</td>
      <td>
        {% if f.status == "PAID" %}
          <span class="badge bg-success">PAID</span>
        {% else %}
          <span class="badge bg-danger">UNPAID</span>
        {% endif %}
      </td>
      <td class="text-nowrap">
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'fine_detail' f.pk %}">View / Pay</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="9" class="text-muted text-center">No fines.</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
